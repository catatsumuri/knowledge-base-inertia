# メッセージへの返信（/reply コマンド）

---

## 概要

Kiro CLI は `/reply` コマンドを通じて、直前のアシスタントメッセージの特定箇所へ返信できる仕組みを提供します。

コマンド実行時の流れ：

* 直前の返信を引用形式（`>` プレフィックス付き）でエディタに展開
* システムのデフォルトエディタを起動
* 未設定の場合は `vi` にフォールバック
* 編集後、保存して終了すると自動送信

複数ポイントへの個別回答や、構造化されたフィードバックに適しています。

---

## 仕組み

### 1. 最新の返信を取得

会話から直近のアシスタントメッセージを取得します。

### 2. 引用付きで整形

各行の先頭に `>` を付与し、出典を明確化します。

### 3. エディタを起動

引用済みコンテンツを含んだ状態でデフォルトエディタを開きます。

### 4. 編集して返信

引用の下・途中・行間など任意の場所に回答を追記します。

### 5. 送信

保存してエディタを閉じると内容が送信されます。

---

## エディタの動作

* **事前入力済み**: 引用形式でメッセージが展開された状態で開始
* **引用形式**: 各行の先頭に `>` が付与
* **柔軟な編集**: 任意の位置に追記可能
* **自動送信**: 正常終了で自動送信

---

# 使用例

## 1. 複数の質問に返信する場合

```
> どのプログラミング言語を使用していますか？
Python

> どのフレームワークを使っていますか？
Django

> どのような具体的なエラーが発生していますか？
API エンドポイントにアクセスしようとすると 404 エラーが発生します。
```

---

## 2. 特定のポイントに対応する場合

```
> 次の 3 つの方法があります:
> 1. データベースマイグレーションを使用する
> 2. モデルを直接更新する
> 3. カスタム管理コマンドを作成する

1 番を選びたいです。マイグレーションの作成方法を教えてもらえますか？

> まずデータのバックアップを取ってください。
すでに完了しています。今朝のフルバックアップがあります。
```

---

## 3. 構造化されたフィードバックを提供する場合

```
> 次の改善をおすすめします:
> - ネットワークリクエストのエラーハンドリングを追加する
> - 入力バリデーションを実装する
> - デバッグ用のログを追加する

すべて賛成です。エラーハンドリングについて:
- try/catch ブロックとデコレーターパターンのどちらを使うべきですか？

ログについて:
- どの程度の詳細レベルをおすすめしますか？
```

---

# ステータスメッセージ

| 状態      | 表示メッセージ                                            |
| ------- | -------------------------------------------------- |
| 成功      | "Content loaded from editor. Submitting prompt..." |
| 変更なし    | "No changes made in editor, not submitting."       |
| メッセージなし | "No assistant message found to reply to."          |
| エディタエラー | "Error opening editor: [specific error details]"   |

---

# エラーハンドリング

* **アシスタントメッセージなし**: 直前の返信が見つからない場合に警告表示
* **エディタ失敗**: エディタプロセスのエラーを詳細表示
* **空の内容**: 変更がない場合は送信をスキップ
* **未変更の内容**: 元テキストと比較し未修正の引用送信を防止

---

# ベストプラクティス

* 複数ポイントへの個別対応が必要な場合に活用する
* 回答は整理し、引用との対応関係を明確にする
* すべてに返答する必要はない。重要箇所に集中する
* 長い会話では引用構造で文脈を維持する

---

# ヒント

* 不要な引用行は削除可能
* 可読性向上のため空行を適切に入れる
* 複雑な議題は引用構造で分割する
* 詳細な返信に対して特に有効

---

# 関連ページ

* Context Management
* Slash Commands
* Conversations
* Prompts

---

# 次のステップ

* より良い応答のために Context Management を学ぶ
* 素早い操作のために Slash Commands を確認する
* Conversations でチャットを保存・管理する
* 効果的な質問のために Prompts を見直す

