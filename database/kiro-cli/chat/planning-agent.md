# Planエージェント

Planエージェントは、アイデアを構造化された実装計画へと変換するための特化型組み込みエージェントです。要件定義や調査をガイドし、実行モードへ切り替える前に詳細なタスク分解を作成します。

---

## はじめに

### モード切り替え

* **Shift + Tab**：プランモードと実行モードを切り替え

### スラッシュコマンド

```bash
/plan
```

起動メッセージ例：

```bash
Kiro の [plan] エージェントに切り替えました。あらゆるアイデアを完全に動作するコードへと変換します。
今日は何を作りたいですか？

[plan] >
```

### 即時プロンプト付き起動

```bash
/plan ユーザー認証のためのREST APIを構築して
```

有効化後の表示：

* プロンプト内の `[plan]` インジケーター
* モード切り替え時のウェルカムメッセージ

---

# プランのワークフロー

## 1. 要件定義

プランナーが構造化された質問を行い、アイデアを具体化します。

例：

```bash
[plan] > ToDoアプリを作りたいです
```

### 特徴

| 機能       | 説明               |
| -------- | ---------------- |
| 構造化された質問 | 明確な番号付きの選択式質問    |
| 柔軟な回答    | 個別回答や自由記述が可能     |
| 反復的プロセス  | 複数回の質問で理解を深める    |
| コンテキスト認識 | 回答に基づきフォローアップを調整 |

---

## 2. 調査と分析

プランナーが既存コードや関連技術を探索します。

| 機能        | 説明                          |
| --------- | --------------------------- |
| コード探索     | code / grep / glob で既存コード把握 |
| 技術調査      | フレームワークやライブラリの特定            |
| アーキテクチャ分析 | 既存構造や慣例の確認                  |

---

## 3. 実装計画の作成

明確な目標と段階的なタスク分解を行います。

### 例：Todo CLI 実装計画

**問題定義**
既存のKiro CLIにタスク管理機能を追加する。

**要件**

* CRUD操作のCLIコマンド
* ローカルSQLiteストレージ
* 優先度・期限日サポート

### タスク分解

#### タスク1：データベース設計

* Todo構造体定義
* マイグレーション作成
* デモ：作成・取得確認

#### タスク2：CLI構造実装

* add/list/complete コマンド追加
* デモ：コマンド受付・ヘルプ表示

#### タスク3：高度機能

* 期限日・優先度ソート
* デモ：完全動作確認

### 各タスクに含まれる要素

* 明確な目標（測定可能）
* 実装ガイダンス
* 動作確認用デモ定義

---

## 4. 計画の承認と引き継ぎ

実行モードへ切り替える前に承認を求めます。

例：

```bash
このプランで良さそうですか？それとも、何か調整したほうがよい点はありますか？
```

承認後：

```bash
実装を開始するために[plan]エージェントを終了してもよろしいですか？ [y/n]
```

### 引き継ぎプロセス

1. 計画を承認
2. 実行切替確認
3. 自動で元エージェントへ復帰
4. 計画が実行エージェントへ転送

---

# 読み取り専用設計

Planエージェントは読み取り専用モードで動作します。

| 操作          | 状態          |
| ----------- | ----------- |
| ファイル読み取り    | ✓           |
| コードインテリジェンス | ✓           |
| grep / glob | ✓           |
| Web検索       | ✓           |
| ファイル書き込み    | ✗           |
| コマンド実行      | ✗（読み取り専用のみ） |
| MCPツール      | ✗           |

---

# ベストプラクティス

* 複雑なタスクで使用する
* 質問に具体的に回答する
* コード探索を許可する
* 計画をレビューする
* 必要なら反復改善する

---

# トラブルシューティング

| 問題               | 解決策              |
| ---------------- | ---------------- |
| Planエージェントを終了したい | Shift + Tab      |
| セッション中断          | `/plan` で再開      |
| 計画が渡らない          | 確認プロンプトで `y` と入力 |

---

# ワークフロー例：ユーザー認証追加

```bash
/plan このWebアプリにユーザー認証を追加してください
```

### 対話例

1. 認証方式選択
2. 技術スタック確認
3. コードベース調査
4. 詳細実装計画提示
5. 承認 → 実行切替

---

# まとめ

Planエージェントは「実装前に思考を整理する」ための専用モードです。

* 要件定義
* 調査
* 段階的タスク分解
* 承認後に実行へ移行

複雑な実装ほど、いきなり書き始めるよりも計画を立てた方が結果は安定します。

