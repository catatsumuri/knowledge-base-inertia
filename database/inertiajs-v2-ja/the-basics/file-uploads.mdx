---
title: ファイルアップロード
---

## `FormData` への変換

ファイル（ネストされたファイルを含む）を含む Inertia リクエストを行う場合、Inertia はリクエストデータを自動的に `FormData` オブジェクトへ変換します。この変換は、XHR を通じて `multipart/form-data` リクエストを送信するために必要です。

データ内にファイルが含まれているかどうかに関わらず、常に `FormData` オブジェクトを使用したい場合は、リクエスト時に `forceFormData` オプションを指定できます。

<CodeGroup>

```js Vue icon="vuejs"
import { router } from '@inertiajs/vue3'

router.post('/users', data, {
    forceFormData: true,
})
```

```js React icon="react"
import { router } from '@inertiajs/react'

router.post('/users', data, {
    forceFormData: true,
})
```

```js Svelte icon="s"
import { router } from '@inertiajs/svelte'

router.post('/users', data, {
    forceFormData: true,
})
```

</CodeGroup>

`FormData` インターフェースについての詳細は、[MDN ドキュメント](https://developer.mozilla.org/en-US/docs/Web/API/FormData)をご覧ください。

## ファイルアップロードの例

Inertia を使用した完全なファイルアップロードの例を見てみましょう。この例には、`name` のテキスト入力と `avatar` のファイル入力の両方が含まれています。

<CodeGroup>

```vue Vue icon="vuejs"
<script setup>
import { useForm } from '@inertiajs/vue3'

const form = useForm({
    name: null,
    avatar: null,
})

function submit() {
    form.post('/users')
}
</script>

<template>
    <form @submit.prevent="submit">
        <input type="text" v-model="form.name" />
        <input type="file" @input="form.avatar = $event.target.files[0]" />
        <progress v-if="form.progress" :value="form.progress.percentage" max="100">
            {{ form.progress.percentage }}%
        </progress>
        <button type="submit">送信</button>
    </form>
</template>
```

```jsx React icon="react"
import { useForm } from '@inertiajs/react'

const { data, setData, post, progress } = useForm({
    name: null,
    avatar: null,
})

function submit(e) {
    e.preventDefault()
    post('/users')
}

return (
    <form onSubmit={submit}>
        <input type="text" value={data.name} onChange={e => setData('name', e.target.value)} />
        <input type="file" onChange={e => setData('avatar', e.target.files[0])} />
        {progress && (
            <progress value={progress.percentage} max="100">
                {progress.percentage}%
            </progress>
        )}
        <button type="submit">送信</button>
    </form>
)
```

```svelte Svelte 4 icon="s"
<script>
    import { useForm } from '@inertiajs/svelte'

    const form = useForm({
        name: null,
        avatar: null,
    })

    function submit() {
        $form.post('/users')
    }
</script>

<form on:submit|preventDefault={submit}>
    <input type="text" bind:value={$form.name} />
    <input type="file" on:input={e => $form.avatar = e.target.files[0]} />
    {#if $form.progress}
        <progress value={$form.progress.percentage} max="100">
            {$form.progress.percentage}%
        </progress>
    {/if}
    <button type="submit">送信</button>
</form>
```

```svelte Svelte 5 icon="s"
<script>
    import { useForm } from '@inertiajs/svelte'

    const form = useForm({
        name: null,
        avatar: null,
    })

    function submit(e) {
        e.preventDefault()
        $form.post('/users')
    }
</script>

<form onsubmit={submit}>
    <input type="text" bind:value={$form.name} />
    <input type="file" oninput={e => $form.avatar = e.target.files[0]} />
    {#if $form.progress}
        <progress value={$form.progress.percentage} max="100">
            {$form.progress.percentage}%
        </progress>
    {/if}
    <button type="submit">送信</button>
</form>
```

</CodeGroup>

この例では、現在のアップロード進捗へ簡単にアクセスできるため、利便性を考慮して [Inertia フォームヘルパー](/v2/the-basics/forms#form-helper) を使用しています。ただし、[手動の Inertia ビジット](/v2/the-basics/manual-visits) を使ってフォームを送信することも可能です。

## Multipart の制限事項

`multipart/form-data` リクエストを使用したファイルアップロードは、`PUT`、`PATCH`、`DELETE` の HTTP メソッドを使用する場合、一部のサーバーサイドフレームワークではネイティブにサポートされていません。この制限に対する最も簡単な回避策は、ファイルのアップロードに `POST` リクエストを使用することです。

ただし、[Laravel](https://laravel.com/docs/routing#form-method-spoofing) や [Rails](https://guides.rubyonrails.org/form_helpers.html#how-do-forms-with-patch-put-or-delete-methods-work-questionmark) のように、フォームメソッドスプーフィングをサポートしているフレームワークもあります。これにより、`POST` を使ってファイルをアップロードしつつ、フレームワーク側ではリクエストを `PUT` や `PATCH` として処理させることができます。これは、リクエストデータに `_method` 属性を含めることで実現されます。

<CodeGroup>

```js Vue icon="vuejs"
import { router } from '@inertiajs/vue3'

router.post(`/users/${user.id}`, {
    _method: 'put',
    avatar: form.avatar,
})
```

```js React icon="react"
import { router } from '@inertiajs/react'

router.post(`/users/${user.id}`, {
    _method: 'put',
    avatar: form.avatar,
})
```

```js Svelte icon="s"
import { router } from '@inertiajs/svelte'

router.post(`/users/${user.id}`, {
    _method: 'put',
    avatar: form.avatar,
})
```

</CodeGroup>
