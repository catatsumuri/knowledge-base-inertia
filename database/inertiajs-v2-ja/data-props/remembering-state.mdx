---
title: 状態の記憶
---

ブラウザ履歴を操作する際、Inertia は履歴状態にキャッシュされたプロップデータを使ってページを復元します。しかし、Inertia はローカルのページコンポーネント状態まで復元することはできません。そのため、ブラウザ履歴に古い状態のページが残る可能性があります。

例えば、ユーザーがフォームの一部を入力した後に別ページへ移動し、再び戻ってきた場合、フォームはリセットされ、入力した内容は失われます。

この問題を回避するには、Inertia にブラウザ履歴に保存すべきローカルコンポーネントの状態を教えることができます。

## ローカル状態の保存

ローカルコンポーネントの状態を履歴状態に保存するには、`useRemember` を使って Inertia にどのデータを記憶させるかを指定します。

<CodeGroup>

```js Vue icon="vuejs"
import { useRemember } from '@inertiajs/vue3'

const form = useRemember({
    first_name: null,
    last_name: null,
})
```

```jsx React icon="react"
import { useRemember } from '@inertiajs/react'

export default function Profile() {
    const [formState, setFormState] = useRemember({
        first_name: null,
        last_name: null,
        // ...
    })

    // ...
}
```

```js Svelte icon="s"
import { useRemember } from '@inertiajs/svelte'

const form = useRemember({
    first_name: null,
    last_name: null,
})

// ...
```

</CodeGroup>

これで、ローカルの `form` 状態が変更されるたびに、Inertia は自動的にこのデータを履歴状態に保存し、履歴操作時に復元します。

## 複数コンポーネント

ページに複数の Inertia の remember 機能を使用するコンポーネントがある場合、各コンポーネントに固有のキーを指定する必要があります。これにより、Inertia はどのデータをどのコンポーネントに復元するかを識別できます。

<CodeGroup>

```js Vue icon="vuejs"
import { useRemember } from '@inertiajs/vue3'

const form = useRemember({
    first_name: null,
    last_name: null,
}, 'Users/Create')
```

```jsx React icon="react"
import { useRemember } from '@inertiajs/react'

export default function Profile() {
    const [formState, setFormState] = useRemember({
        first_name: null,
        last_name: null,
    }, 'Users/Create')
}
```

```js Svelte icon="s"
import { page, useRemember } from '@inertiajs/svelte'

const form = useRemember({
    first_name: null,
    last_name: null,
}, 'Users/Create')
```

</CodeGroup>

同じコンポーネントが複数インスタンス存在する場合は、モデルの ID などを使って各インスタンスにも固有のキーを指定してください。

<CodeGroup>

```js Vue icon="vuejs"
import { useRemember } from '@inertiajs/vue3'

const props = defineProps({ user: Object })

const form = useRemember({
    first_name: null,
    last_name: null,
}, `Users/Edit:${props.user.id}`)
```

```jsx React icon="react"
import { useRemember } from '@inertiajs/react'

export default function Profile() {
    const [formState, setFormState] = useRemember({
        first_name: props.user.first_name,
        last_name: props.user.last_name,
    }, `Users/Edit:${this.user.id}`)
}
```

```js Svelte icon="s"
import { page, useRemember } from '@inertiajs/svelte'

const form = useRemember({
    first_name: $page.props.user.first_name,
    last_name: $page.props.user.last_name,
}, `Users/Edit:${$page.props.user.id}`)
```

</CodeGroup>

## フォームヘルパー

[Inertia フォームヘルパー](/v2/the-basics/forms#form-helper) を使用している場合、フォームを作成するときに一意のフォームキーを第一引数として渡すことで、フォームデータやエラーを自動的に記憶させることができます。

<CodeGroup>

```js Vue icon="vuejs"
import { useForm } from '@inertiajs/vue3'

const form = useForm('CreateUser', data)
const form = useForm(`EditUser:${props.user.id}`, data)
```

```js React icon="react"
import { useForm } from '@inertiajs/react'

const form = useForm('CreateUser', data)
const form = useForm(`EditUser:${user.id}`, data)
```

```js Svelte icon="s"
import { useForm } from '@inertiajs/svelte'

const form = useForm('CreateUser', data)
const form = useForm(`EditUser:${user.id}`, data)
```

</CodeGroup>

`dontRemember()` メソッドを使うと、特定のフィールドを記憶させないようにできます。パスワードのような履歴状態に保存したくない機密フィールドで便利です。

## 手動で状態を保存する

`useRemember` フックはデータの変更を監視し、自動的に履歴状態に保存します。そして Inertia はページロード時にデータを復元します。

しかし、Inertia が提供する `remember()` と `restore()` メソッドを使って手動で管理することも可能です。

<CodeGroup>

```js Vue icon="vuejs"
import { router } from '@inertiajs/vue3'

// ローカルコンポーネント状態を履歴状態に保存
router.remember(data, 'my-key')

// 履歴状態からローカルコンポーネント状態を復元
let data = router.restore('my-key')
```

```js React icon="react"
import { router } from '@inertiajs/react'

// ローカルコンポーネント状態を履歴状態に保存
router.remember(data, 'my-key')

// 履歴状態からローカルコンポーネント状態を復元
let data = router.restore('my-key')
```

```js Svelte icon="s"
import { router } from '@inertiajs/svelte'

// ローカルコンポーネント状態を履歴状態に保存
router.remember(data, 'my-key')

// 履歴状態からローカルコンポーネント状態を復元
let data = router.restore('my-key')
```

</CodeGroup>

<Warning>
一部のブラウザでは短時間に `history.replaceState()` を呼び出す回数に制限があります。
Inertia はこのエラーをキャッチしてコンソールに記録しますが、状態の更新は失われます。
`router.remember()` を頻繁に呼び出さないようにし、高頻度の更新がある場合はデバウンスやバッチ処理を検討してください。
</Warning>
