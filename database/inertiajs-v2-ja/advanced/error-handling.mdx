---
title: エラーハンドリング
---

## 開発

堅牢なサーバーサイドフレームワークで作業する利点のひとつは、例外ハンドリングが最初から組み込まれていることです。たとえば、Laravel には美しいエラーレポートツールが同梱されており、ローカル開発時に整形されたスタックトレースを表示してくれます。

課題となるのは、XHR リクエスト（Inertia が行っているもの）を送信してサーバーサイドでエラーが発生した場合、問題を診断するためにブラウザの開発者ツールのネットワークタブを掘り下げる必要がある点です。

Inertia はこの問題を、Inertia 以外のすべてのレスポンスをモーダルで表示することで解決します。これにより、XHR 経由のリクエストであっても、慣れ親しんだ美しいエラーレポートをそのまま利用できます。

## Dialog 要素

デフォルトでは、Inertia はカスタムの `<div>` オーバーレイを使用してエラーモーダルを表示します。しかし、代わりにネイティブの HTML `<dialog>` 要素を使用するようオプトインすることもできます。これにより、バックドロップ処理を含む組み込みのモーダル機能を利用できます。

これを有効にするには、[アプリケーションのデフォルト設定](/v2/installation/client-side-setup#configuring-defaults)で `future.useDialogForErrorModal` オプションを設定してください。

```js
createInertiaApp({
    // resolve, setup, etc.
    defaults: {
        future: {
            useDialogForErrorModal: true,
        },
    },
})
```

## 本番環境

本番環境では、開発時に提供されるモーダル駆動のエラーレポートに依存するのではなく、適切な Inertia エラーレスポンスを返すようにする必要があります。これを実現するには、フレームワークのデフォルトの例外ハンドラを更新し、カスタムのエラーページを返すようにします。

Laravel アプリケーションを構築している場合、アプリケーションの `bootstrap/app.php` ファイルで `respond` 例外メソッドを使用することで実現できます。

```php
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;
use Inertia\Inertia;

->withExceptions(function (Exceptions $exceptions) {
    $exceptions->respond(function (Response $response, Throwable $exception, Request $request) {
        if (! app()->environment(['local', 'testing']) && in_array($response->getStatusCode(), [500, 503, 404, 403])) {
            return Inertia::render('ErrorPage', ['status' => $response->getStatusCode()])
                ->toResponse($request)
                ->setStatusCode($response->getStatusCode());
        }

        if ($response->getStatusCode() === 419) {
            return back()->with([
                'message' => 'The page expired, please try again.',
            ]);
        }

        return $response;
    });
})
```

上記の例では `ErrorPage` というページコンポーネントを返していることにお気づきかもしれません。このコンポーネントを実際に作成する必要があります。これはアプリケーション全体で使用される汎用的なエラーページとなります。以下は、出発点として使えるエラーコンポーネントの例です。

<CodeGroup>

```vue Vue icon="vuejs"
<script setup>
import { computed } from 'vue'

const props = defineProps({ status: Number })

const title = computed(() => {
    return {
        503: '503: Service Unavailable',
        500: '500: Server Error',
        404: '404: Page Not Found',
        403: '403: Forbidden',
    }[props.status]
})

const description = computed(() => {
    return {
        503: 'Sorry, we are doing some maintenance. Please check back soon.',
        500: 'Whoops, something went wrong on our servers.',
        404: 'Sorry, the page you are looking for could not be found.',
        403: 'Sorry, you are forbidden from accessing this page.',
    }[props.status]
})
</script>

<template>
    <div>
        <h1>{{ title }}</h1>
        <div>{{ description }}</div>
    </div>
</template>
```

```jsx React icon="react"
export default function ErrorPage({ status }) {
    const title = {
        503: '503: Service Unavailable',
        500: '500: Server Error',
        404: '404: Page Not Found',
        403: '403: Forbidden',
    }[status]

    const description = {
        503: 'Sorry, we are doing some maintenance. Please check back soon.',
        500: 'Whoops, something went wrong on our servers.',
        404: 'Sorry, the page you are looking for could not be found.',
        403: 'Sorry, you are forbidden from accessing this page.',
    }[status]

    return (
        <div>
            <H1>{title}</H1>
            <div>{description}</div>
        </div>
    )
}
```

```svelte Svelte 4 icon="s"
<script>
    export let status

    $: title = {
        503: '503: Service Unavailable',
        500: '500: Server Error',
        404: '404: Page Not Found',
        403: '403: Forbidden',
    }[status]

    $: description = {
        503: 'Sorry, we are doing some maintenance. Please check back soon.',
        500: 'Whoops, something went wrong on our servers.',
        404: 'Sorry, the page you are looking for could not be found.',
        403: 'Sorry, you are forbidden from accessing this page.',
    }[status]
</script>

<div>
    <h1>{title}</h1>
    <div>{description}</div>
</div>
```

```svelte Svelte 5 icon="s"
<script>
    let { status } = $props()

    const title = {
        503: '503: Service Unavailable',
        500: '500: Server Error',
        404: '404: Page Not Found',
        403: '403: Forbidden',
    }

    const description = {
        503: 'Sorry, we are doing some maintenance. Please check back soon.',
        500: 'Whoops, something went wrong on our servers.',
        404: 'Sorry, the page you are looking for could not be found.',
        403: 'Sorry, you are forbidden from accessing this page.',
    }
</script>

<div>
    <h1>{title[status]}</h1>
    <div>{description[status]}</div>
</div>
```

</CodeGroup>
