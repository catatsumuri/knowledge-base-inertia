---
title: Defered Props
---

Inertia の遅延 props 機能を使うと、初回のページ描画後まで特定のページデータの読み込みを遅らせることができます。これにより、初回のページ描画をできるだけ速く行えるため、アプリの体感パフォーマンスを向上させるのに役立ちます。

## サーバーサイド

prop を遅延させるには、レスポンスを返す際に `Inertia::defer()` メソッドを使用します。このメソッドは、prop データを返すコールバックを受け取ります。コールバックは、初回のページ描画後に別リクエストとして実行されます。

```php
Route::get('/users', function () {
    return Inertia::render('Users/Index', [
        'users' => User::all(),
        'roles' => Role::all(),
        'permissions' => Inertia::defer(fn () => Permission::all()),
    ]);
});
```

### リクエストのグルーピング

デフォルトでは、すべての遅延 props は初回ページ描画後に 1 つのリクエストで取得されますが、props をグループ化することで並列にデータを取得することもできます。

```php
Route::get('/users', function () {
    return Inertia::render('Users/Index', [
        'users' => User::all(),
        'roles' => Role::all(),
        'permissions' => Inertia::defer(fn () => Permission::all()),
        'teams' => Inertia::defer(fn () => Team::all(), 'attributes'),
        'projects' => Inertia::defer(fn () => Project::all(), 'attributes'),
        'tasks' => Inertia::defer(fn () => Task::all(), 'attributes'),
    ]);
});
```

上記の例では、`teams`、`projects`、`tasks` の props は 1 つのリクエストで取得され、一方で `permissions` の prop は別のリクエストとして並列に取得されます。グループ名は任意の文字列で、自由に指定できます。

## クライアントサイド

クライアントサイドでは、Inertia は遅延 props を管理するための `Deferred` コンポーネントを提供しています。このコンポーネントは、指定された遅延 props が利用可能になるまで自動的に待機し、その後に子要素を描画します。

<CodeGroup>

```vue Vue icon="vuejs"
<script setup>
import { Deferred } from '@inertiajs/vue3'
</script>

<template>
    <Deferred data="permissions">
        <template #fallback>
            <div>読み込み中...</div>
        </template>

        <div v-for="permission in permissions">
            <!-- ... -->
        </div>
    </Deferred>
</template>
```

```jsx React icon="react"
import { Deferred } from '@inertiajs/react'

export default () => (
    <Deferred data="permissions" fallback={<div>読み込み中...</div>}>
        <PermissionsChildComponent />
    </Deferred>
)
```

```svelte Svelte 4 icon="s"
<script>
    import { Deferred } from '@inertiajs/svelte'

    export let permissions
</script>

<Deferred data="permissions">
    <svelte:fragment slot="fallback">
        <div>読み込み中...</div>
    </svelte:fragment>

    {#each permissions as permission}
        <!-- ... -->
    {/each}
</Deferred>
```

```svelte Svelte 5 icon="s"
<script>
    import { Deferred } from '@inertiajs/svelte'

    let { permissions } = $props()
</script>

<Deferred data="permissions">
    {#snippet fallback()}
        <div>読み込み中...</div>
    {/snippet}

    {#each permissions as permission}
        <!-- ... -->
    {/each}
</Deferred>
```

</CodeGroup>

## 複数の遅延 Props

複数の遅延 props が利用可能になるのを待つ必要がある場合は、`data` prop に配列を指定できます。

<CodeGroup>

```vue Vue icon="vuejs"
<script setup>
import { Deferred } from '@inertiajs/vue3'
</script>

<template>
    <Deferred :data="['teams', 'users']">
        <template #fallback>
            <div>読み込み中...</div>
        </template>

        <!-- Props は読み込み済み -->
    </Deferred>
</template>
```

```jsx React icon="react"
import { Deferred } from '@inertiajs/react'

export default () => (
    <Deferred data={['teams', 'users']} fallback={<div>読み込み中...</div>}>
        <ChildComponent />
    </Deferred>
)
```

```svelte Svelte 4 icon="s"
<script>
    import { Deferred } from '@inertiajs/svelte'

    export let teams
    export let users
</script>

<Deferred data={['teams', 'users']}>
    <svelte:fragment slot="fallback">
        <div>読み込み中...</div>
    </svelte:fragment>

    <!-- Props は読み込み済み -->
</Deferred>
```

```svelte Svelte 5 icon="s"
<script>
    import { Deferred } from '@inertiajs/svelte'

    let { teams, users } = $props()
</script>

<Deferred data={['teams', 'users']}>
    {#snippet fallback()}
        <div>読み込み中...</div>
    {/snippet}

    <!-- Props は読み込み済み -->
</Deferred>
```

</CodeGroup>

## Once Props との組み合わせ

遅延 prop に `once()` 修飾子をチェーンすることで、データが一度だけ解決され、その後のナビゲーションでもクライアント側で記憶されるようにできます。

```php
return Inertia::render('Dashboard', [
    'stats' => Inertia::defer(fn () => Stats::generate())->once(),
]);
```

once props の詳細については、[once props](/v2/data-props/once-props) のドキュメントを参照してください。
