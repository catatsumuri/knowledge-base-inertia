---
title: Load When Visible
---

Inertia は、Intersection Observer API を使用して、スクロール時のデータの遅延読み込みをサポートしています。`WhenVisible` コンポーネントは、要素がビューポート内に表示されたときにデータを読み込むための便利な方法を提供します。

`WhenVisible` コンポーネントは、読み込む prop のキーを指定する `data` prop を受け取ります。また、データの読み込み中に表示するコンポーネントを指定する `fallback` prop も受け取ります。`WhenVisible` コンポーネントは、データに依存するコンポーネントをラップする必要があります。

<CodeGroup>

```vue Vue icon="vuejs"
<script setup>
import { WhenVisible } from '@inertiajs/vue3'
</script>

<template>
    <WhenVisible data="permissions">
        <template #fallback>
            <div>Loading...</div>
        </template>

        <div v-for="permission in permissions">
            <!-- ... -->
        </div>
    </WhenVisible>
</template>
```

```jsx React icon="react"
import { WhenVisible } from '@inertiajs/react'

export default () => (
    <WhenVisible data="permissions" fallback={() => <div>Loading...</div>}>
        <PermissionsChildComponent />
    </WhenVisible>
)
```

```svelte Svelte 4 icon="s"
<script>
    import { WhenVisible } from '@inertiajs/svelte'

    export let permissions
</script>

<WhenVisible data="permissions">
    <svelte:fragment slot="fallback">
        <div>Loading...</div>
    </svelte:fragment>

    {#each permissions as permission}
        <!-- ... -->
    {/each}
</WhenVisible>
```

```svelte Svelte 5 icon="s"
<script>
    import { WhenVisible } from '@inertiajs/svelte'

    let { permissions } = $props()
</script>

<WhenVisible data="permissions">
    {#snippet fallback()}
        <div>Loading...</div>
    {/snippet}

    {#each permissions as permission}
        <!-- ... -->
    {/each}
</WhenVisible>
```

</CodeGroup>

要素が表示されたときに複数の prop を読み込みたい場合は、`data` prop に配列を渡すことができます。

<CodeGroup>

```vue Vue icon="vuejs"
<script setup>
import { WhenVisible } from '@inertiajs/vue3'
</script>

<template>
    <WhenVisible :data="['teams', 'users']">
        <template #fallback>
            <div>Loading...</div>
        </template>

        <!-- Props are now loaded -->
    </WhenVisible>
</template>
```

```jsx React icon="react"
import { WhenVisible } from '@inertiajs/react'

export default () => (
    <WhenVisible data={['teams', 'users']} fallback={() => <div>Loading...</div>}>
        <ChildComponent />
    </WhenVisible>
)
```

```svelte Svelte 4 icon="s"
<script>
    import { WhenVisible } from '@inertiajs/svelte'

    export let teams
    export let users
</script>

<WhenVisible data={['teams', 'users']}>
    <svelte:fragment slot="fallback">
        <div>Loading...</div>
    </svelte:fragment>

    <!-- Props are now loaded -->
</WhenVisible>
```

```svelte Svelte 5 icon="s"
<script>
    import { WhenVisible } from '@inertiajs/svelte'

    let { teams, users } = $props()
</script>

<WhenVisible data={['teams', 'users']}>
    {#snippet fallback()}
        <div>Loading...</div>
    {/snippet}

    <!-- Props are now loaded -->
</WhenVisible>
```

</CodeGroup>

## 表示前に読み込む

要素が表示される前にデータの読み込みを開始したい場合は、`buffer` prop に値を指定できます。buffer の値は、要素が表示される何ピクセル前から読み込みを開始するかを表す数値です。

<CodeGroup>

```vue Vue icon="vuejs"
<script setup>
import { WhenVisible } from '@inertiajs/vue3'
</script>

<template>
    <WhenVisible data="permissions" :buffer="500">
        <template #fallback>
            <div>Loading...</div>
        </template>

        <div v-for="permission in permissions">
            <!-- ... -->
        </div>
    </WhenVisible>
</template>
```

```jsx React icon="react"
import { WhenVisible } from '@inertiajs/react'

export default () => (
    <WhenVisible data="permissions" buffer={500} fallback={() => <div>Loading...</div>}>
        <PermissionsChildComponent />
    </WhenVisible>
)
```

```svelte Svelte 4 icon="s"
<script>
    import { WhenVisible } from '@inertiajs/svelte'

    export let permissions
</script>

<WhenVisible data="permissions" buffer={500}>
    <svelte:fragment slot="fallback">
        <div>Loading...</div>
    </svelte:fragment>

    {#each permissions as permission}
        <!-- ... -->
    {/each}
</WhenVisible>
```

```svelte Svelte 5 icon="s"
<script>
    import { WhenVisible } from '@inertiajs/svelte'

    let { permissions } = $props()
</script>

<WhenVisible data="permissions" buffer={500}>
    {#snippet fallback()}
        <div>Loading...</div>
    {/snippet}

    {#each permissions as permission}
        <!-- ... -->
    {/each}
</WhenVisible>
```

</CodeGroup>

上記の例では、要素が表示される 500 ピクセル前からデータの読み込みが開始されます。

デフォルトでは、`WhenVisible` コンポーネントは、要素がビューポート内に表示されていることを確認するために、fallback テンプレートを `div` 要素でラップします。ラッパー要素をカスタマイズしたい場合は、`as` prop を指定できます。

<CodeGroup>

```vue Vue icon="vuejs"
<script setup>
import { WhenVisible } from '@inertiajs/vue3'
</script>

<template>
    <WhenVisible data="products" as="span">
        <!-- ... -->
    </WhenVisible>
</template>
```

```jsx React icon="react"
import { WhenVisible } from '@inertiajs/react'

export default () => (
    <WhenVisible data="products" as="span">
        <ProductsChildComponent />
    </WhenVisible>
)
```

```svelte Svelte 4 icon="s"
<script>
    import { WhenVisible } from '@inertiajs/svelte'

    export let products
</script>

<WhenVisible data="products" as="span">
    <!-- ... -->
</WhenVisible>
```

```svelte Svelte 5 icon="s"
<script>
    import { WhenVisible } from '@inertiajs/svelte'

    let { products } = $props()
</script>

<WhenVisible data="products" as="span">
    <!-- ... -->
</WhenVisible>
```

</CodeGroup>

## 常にトリガーする

デフォルトでは、`WhenVisible` コンポーネントは、要素が表示されたときに一度だけトリガーされます。要素が表示されるたびに常にデータ読み込みをトリガーしたい場合は、`always` prop を指定できます。

これは、無限スクロールリストの末尾にある要素が表示されるたびに追加のデータを読み込みたい場合などに便利です。あるいは、このユースケースを処理する [Infinite scroll](/v2/data-props/infinite-scroll) コンポーネントを使用することもできます。

なお、データ読み込みリクエストがすでに進行中の場合、要素がビューポート内に表示されたままであれば、現在のリクエストが完了するまで次のリクエストは開始されません。

<CodeGroup>

```vue Vue icon="vuejs"
<script setup>
import { WhenVisible } from '@inertiajs/vue3'
</script>

<template>
    <WhenVisible data="products" always>
        <!-- ... -->
    </WhenVisible>
</template>
```

```jsx React icon="react"
import { WhenVisible } from '@inertiajs/react'

export default () => (
    <WhenVisible data="products" always>
        <ProductsChildComponent />
    </WhenVisible>
)
```

```svelte Svelte 4 icon="s"
<script>
    import { WhenVisible } from '@inertiajs/svelte'

    export let products
</script>

<WhenVisible data="products" always>
    <!-- ... -->
</WhenVisible>
```

```svelte Svelte 5 icon="s"
<script>
    import { WhenVisible } from '@inertiajs/svelte'

    let { products } = $props()
</script>

<WhenVisible data="products" always>
    <!-- ... -->
</WhenVisible>
```

</CodeGroup>

### フェッチ状態

`WhenVisible` コンポーネントは、後続のリクエスト中にローディングインジケーターを表示するために使用できる `fetching` スロットプロパティを公開しています。`fallback` は初回読み込み時にのみ表示される一方で、`fetching` はその後の再読み込み時にデータが更新されていることを示すために使用できるため、これは便利です。

<CodeGroup>

```vue Vue icon="vuejs"
<script setup>
import { WhenVisible } from '@inertiajs/vue3'
</script>

<template>
    <WhenVisible data="permissions" always>
        <template #default="{ fetching }">
            <PermissionsChildComponent />
            <div v-if="fetching">Refreshing...</div>
        </template>

        <template #fallback>
            <div>Loading...</div>
        </template>
    </WhenVisible>
</template>
```

```jsx React icon="react"
import { WhenVisible } from '@inertiajs/react'

export default () => (
    <WhenVisible data="permissions" always fallback={() => <div>Loading...</div>}>
        {({ fetching }) => (
            <>
                <PermissionsChildComponent />
                {fetching && <div>Refreshing...</div>}
            </>
        )}
    </WhenVisible>
)
```

```svelte Svelte 4 icon="s"
<script>
    import { WhenVisible } from '@inertiajs/svelte'

    export let permissions
</script>

<WhenVisible data="permissions" always let:fetching>
    <PermissionsChildComponent />
    {#if fetching}
        <div>Refreshing...</div>
    {/if}

    <svelte:fragment slot="fallback">
        <div>Loading...</div>
    </svelte:fragment>
</WhenVisible>
```

```svelte Svelte 5 icon="s"
<script>
    import { WhenVisible } from '@inertiajs/svelte'

    let { permissions } = $props()
</script>

<WhenVisible data="permissions" always let:fetching>
    <PermissionsChildComponent />
    {#if fetching}
        <div>Refreshing...</div>
    {/if}

    {#snippet fallback()}
        <div>Loading...</div>
    {/snippet}
</WhenVisible>
```

</CodeGroup>

## フォーム送信

フォームを送信する際、`WhenVisible` コンポーネントで使用されている prop を除外するために `except` オプションを使用したい場合があります。これにより、バリデーションエラーによって現在のページにリダイレクトされた際に、これらの prop が再読み込みされるのを防ぐことができます。

<CodeGroup>

```vue Vue icon="vuejs"
<script setup>
import { useForm, WhenVisible } from '@inertiajs/vue3'

const form = useForm({
    name: '',
    email: '',
})

function submit() {
    form.post('/users', {
        except: ['permissions'],
    })
}
</script>

<template>
    <form @submit.prevent="submit">
        <!-- ... -->
    </form>

    <WhenVisible data="permissions">
        <!-- ... -->
    </WhenVisible>
</template>
```

```jsx React icon="react"
import { useForm, WhenVisible } from '@inertiajs/react'

export default function CreateUser() {
    const { data, setData, post } = useForm({
        name: '',
        email: '',
    })

    function submit(e) {
        e.preventDefault()
        post('/users', {
            except: ['permissions'],
        })
    }

    return (
        <>
            <form onSubmit={submit}>
                {/* ... */}
            </form>

            <WhenVisible data="permissions">
                {/* ... */}
            </WhenVisible>
        </>
    )
}
```

```svelte Svelte 4 icon="s"
<script>
    import { useForm, WhenVisible } from '@inertiajs/svelte'

    const form = useForm({
        name: '',
        email: '',
    })

    function submit() {
        $form.post('/users', {
            except: ['permissions'],
        })
    }
</script>

<form on:submit|preventDefault={submit}>
    <!-- ... -->
</form>

<WhenVisible data="permissions">
    <!-- ... -->
</WhenVisible>
```

```svelte Svelte 5 icon="s"
<script>
    import { useForm, WhenVisible } from '@inertiajs/svelte'

    const form = useForm({
        name: '',
        email: '',
    })

    function submit() {
        form.post('/users', {
            except: ['permissions'],
        })
    }
</script>

<form onsubmit={submit}>
    <!-- ... -->
</form>

<WhenVisible data="permissions">
    <!-- ... -->
</WhenVisible>
```

</CodeGroup>
